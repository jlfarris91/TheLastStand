package Spikes
import Camp
import FX
import ClosureTimers

// ============================================================================
public class Spikes extends CampBuilding

  // --------------------------------------------------------------------------
  construct(ICamp camp)
    super(camp)
    listenToUnitDamagedEvent()

  // --------------------------------------------------------------------------
  protected override function onDamaged()
    super.onDamaged()

    let attacker = getUnit()
    attacker.subHP(GetEventDamage())

    let fxPos = attacker.getPos()

    let fx = FX.createEffect("Abilities\\Weapons\\Rifle\\RifleImpact.mdl", fxPos)
    fx.setAlpha(255)
    fx.setColor(255, 255, 255)
    fx.setScale(0.8)
    doAfter(3) ->
      DestroyEffect(fx)

    let fx2 = FX.createEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl", fxPos)
    fx2.setAlpha(255)
    fx2.setColor(255, 255, 255)
    fx2.setScale(0.2)
    fx.setTimeScale(2.0)
    doAfter(3) ->
      DestroyEffect(fx)