package Tent
import Camp
import Events
import UnitMetadata
import Survivors

// ============================================================================
public class Tent extends CampUnit
  private Action m_unitConstructedEventHandler

  // --------------------------------------------------------------------------
  construct(ICamp camp)
    super(camp)
    listenToUnitConstructedEvent()

  // --------------------------------------------------------------------------
  ondestroy
    unlistenToUnitConstructedEvent()

  // --------------------------------------------------------------------------
  private function onConstructed()
    spawnSurvivorUnitForPlayer(this.getOwner())

  // --------------------------------------------------------------------------
  private function listenToUnitConstructedEvent()
    unlistenToUnitConstructedEvent()
    if (m_unitConstructedEventHandler == null)
      m_unitConstructedEventHandler = PlayerUnitEvents.unitConstructed.add() -> 
        if (GetConstructedStructure() == getUnit())
          onConstructed()

  // --------------------------------------------------------------------------
  private function unlistenToUnitConstructedEvent()
    if (m_unitConstructedEventHandler != null)
      PlayerUnitEvents.unitConstructed.remove(m_unitConstructedEventHandler)
      destroy m_unitConstructedEventHandler
      m_unitConstructedEventHandler = null