package TLSMenuBar
import LoadToc
import ClosureTimers
import HumanPlayers
import HashMap

import TLSMenuButton
import Frame
import TLSMenuToggleButton
import StackPanel
import Layout
import ProjectConstants
import DebuggerButton

import AlliancesButton
import DiscordLinkButton
import CameraButton
import HiveLinkButton
import HelpMenuButton
import RotateStructuresButton

public constant int MENU_ITEM_HIVE = 0
public constant int MENU_ITEM_DISCORD = 1
public constant int MENU_ITEM_ALLIANCES = 2
public constant int MENU_ITEM_CAMERA = 3
public constant int MENU_ITEM_HELP_MENU = 4
public constant int MENU_ITEM_ROTATE_BUILDINGS = 5
public constant int MENU_ITEM_DEBUG = 6
public constant int MENU_ITEM_COUNT = 7

HashMap<player, TLSMenuBar> g_playerToMenuMap = new HashMap<player, TLSMenuBar>()

// ============================================================================
public class TLSMenuBar extends StackPanel
  TLSMenuButton array[MENU_ITEM_COUNT] m_items

  // --------------------------------------------------------------------------
  construct(player _player)
    super("TLSMB")

    setPlayer(_player)

    setOrientation(LayoutOrientation.LEFTTORIGHT)

    m_items[MENU_ITEM_HIVE] = new HiveToggleButton(this, _player)
    addChild(m_items[MENU_ITEM_HIVE])

    m_items[MENU_ITEM_DISCORD] = new DiscordToggleButton(this, _player)
    addChild(m_items[MENU_ITEM_DISCORD])

    m_items[MENU_ITEM_ALLIANCES] = new AlliancesToggleButton(this, _player)
    addChild(m_items[MENU_ITEM_ALLIANCES])

    m_items[MENU_ITEM_CAMERA] = new CameraToggleButton(this, _player)
    addChild(m_items[MENU_ITEM_CAMERA])

    m_items[MENU_ITEM_HELP_MENU] = new HelpMenuButton(this, _player)
    addChild(m_items[MENU_ITEM_HELP_MENU])

    m_items[MENU_ITEM_ROTATE_BUILDINGS] = new RotateStructuresButton(this, _player)
    addChild(m_items[MENU_ITEM_ROTATE_BUILDINGS])

    if (DEV_ENVIRONMENT)
      m_items[MENU_ITEM_DEBUG] = new DebuggerButton(this, _player)
      addChild(m_items[MENU_ITEM_DEBUG])

  // --------------------------------------------------------------------------
  function uncheckOthers(TLSMenuButton menuButton)
    for i = 0 to MENU_ITEM_COUNT - 1
      let otherMenuToggleButton = m_items[i] castTo TLSMenuToggleButton
      if (otherMenuToggleButton != null and otherMenuToggleButton != menuButton)
        otherMenuToggleButton.setIsChecked(false)

// ============================================================================
function createMenusForPlayers()

  let itemSize = vec2(0.03, 0.03)
  let pos = vec2(0.46, 0.57)
  let size = vec2(REAL_MAX, itemSize.y)

  for _player in g_PlayingHumanPlayers
    let menu = new TLSMenuBar(_player)
      ..setAbsArea(FRAMEPOINT_TOPLEFT, pos, size)
      ..showOnly(_player)
    g_playerToMenuMap.put(_player, menu)

// ============================================================================
public function getTLSMenu(player p) returns TLSMenuBar
  return g_playerToMenuMap.get(p)

// ============================================================================
init
  ensureTocIsLoaded()
  nullTimer(() -> createMenusForPlayers())