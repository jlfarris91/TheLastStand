package Item_Materials
import RegisterEvents
import GameConstants
import FX
import MainItemLibrary
import TlsItemIds
import HumanPlayerMetadata

function onItemAcquired()
  let u = GetManipulatingUnit()
  let i = GetManipulatedItem()

  let ownerMetadata = u.getOwnerHumanMetadata()
  if (ownerMetadata == null)
    return

  if (i.getTypeId() != TlsItemIds.materials)
    return

  i.remove()
  
  var reward = GetRandomInt(MATERIALS_ITEM_REWARD_MIN, MATERIALS_ITEM_REWARD_MAX)
  ownerMetadata.giveMaterials(reward)

  var x = u.getX()
  var y = u.getY()

  FX.createGoldCreditEffect(x, y, ownerMetadata.getPlayer())
  FX.createFoundMaterialsTag(x, y, reward, ownerMetadata.getPlayer())

init
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_PICKUP_ITEM, function onItemAcquired)
  
  g_MainItemLibrary.commonSet.add(TlsItemIds.materials, 50.0)