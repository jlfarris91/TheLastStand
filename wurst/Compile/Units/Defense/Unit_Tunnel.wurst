package Unit_Tunnel
import TlsBuildingDefinition
import Icons
import ChannelAbilityPreset

public constant real TUNNEL_ENTRANCE_BUILD_DURATION = 5.0
constant real TUNNEL_ENTRANCE_LOAD_SMART_MOVE_UNIT_RADIUS = 80.0

// ============================================================================
@compiletime function createObjects()

  new AbilityDefinitionCargoHoldTransport(TlsAbilityIds.tunnelEntrance_cargoHoldBuilder)
    ..setCargoCapacity(1, 1)
    ..setTargetsAllowed(1, "allied,friend,ground,invulnerable,nonsapper,vulnerable")

  new AbilityDefinitionLoad(TlsAbilityIds.tunnelEntrance_loadBuilder)
    ..setAllowedUnitType(1, commaList(TlsUnitIds.Survivors.builder1))

  new UnitDefinition(TlsUnitIds.tunnelEntrance_trainUnit, UnitIds.peasant)
    ..setGoldCost(0)
    ..setLumberCost(0)
    ..setBuildTime(TUNNEL_ENTRANCE_BUILD_DURATION.toInt())
    ..setFoodCost(0)
    ..setFoodProduced(0)
    ..setButtonPositionX(0)
    ..setButtonPositionY(-11)
    ..setIconGameInterface(Icons.bTNBacktoWork)
    ..setName("Digging Tunnel")

  new TlsBuildingDefinition(TlsUnitIds.tunnelEntrance, UnitIds.scouttower)
    ..setNormalAbilities(commaList(TlsAbilityIds.tunnelEntrance_cargoHoldBuilder, TlsAbilityIds.tunnelEntrance_loadBuilder, AbilityIds.invulnerable, AbilityIds.unloadInstant, TlsAbilityIds.recycle))
    ..setButtonPositionX(3)
    ..setButtonPositionY(0)
    ..setDeathTimeseconds(3.334)
    ..setModelFile("buildings\\human\\tunnel\\tunnelentrance.mdl")
    ..setIconGameInterface("ReplaceableTextures\\CommandButtons\\BTNTunnelEntrance.blp")
    ..setRequiredAnimationNames("")
    ..setShadowTextureBuilding("")
    ..setScalingValue(0.75)
    ..setPathingMap("PathTextures\\TunnelEntrance.tga")
    ..setBuildTime(20)
    ..setCanFlee(false)
    ..setHitPointsMaximumBase(1000)
    ..setGoldCost(1)
    ..setLumberCost(400)
    ..setSightRadiusDay(400)
    ..setSightRadiusNight(400)
    ..setUpgradesTo("")
    ..setUpgradesUsed("")
    ..setName("Tunnel Entrance")
    ..setTooltipBasic("Build Tunnel Entrance")
    ..setTooltipExtended("One end of a tunnel yet to be built. Build two and dig a tunnel between them.")
    ..setUnitsTrained(commaList(TlsUnitIds.tunnelEntrance_trainUnit))
    ..setDeathType(DeathType.CannotRaiseDoesDecay)
    ..setRequirements(commaList(TlsUnitIds.workshop))

  new ChannelAbilityPreset(TlsAbilityIds.tunnelEntrance_digTunnel, 1, true)    
    ..setHeroAbility(false)
    ..setItemAbility(false)
    ..presetTargetTypes(Targettype.UNIT)
    ..removeChannelProperties(true, true)
    ..presetBaseOrderID((lvl) -> "magicleash")
    ..setIconNormal(Icons.bTNBacktoWork)
    ..setName("Dig Tunnel")
    ..setTooltipNormal(1, "Dig Tunnel")
    ..setTooltipNormalExtended(1, "Target another Tunnel Entrance to dig a tunnel between them.")
    ..presetCastRange((int lvl) -> 1024.0)
    ..presetTargetsAllowed((int lvl) -> "structure,ground,invulnerable")
    ..setButtonPositionNormalX(0)
    ..setButtonPositionNormalY(2)

  new ChannelAbilityPreset(TlsAbilityIds.tunnelEntrance_loadSmartMoveUnit, 1, true)    
    ..setHeroAbility(false)
    ..setItemAbility(false)
    ..presetTargetTypes(Targettype.UNIT)
    ..removeChannelProperties(true, true)
    ..presetBaseOrderID((lvl) -> "load")
    ..setIconNormal(Icons.bTNLoad)
    ..setName("Load Unit")
    ..setTooltipNormal(1, "Travel Tunnel")
    ..setTooltipNormalExtended(1, "Target a unit to load it into the tunnel.")
    ..presetCastRange((int lvl) -> TUNNEL_ENTRANCE_LOAD_SMART_MOVE_UNIT_RADIUS)
    ..presetTargetsAllowed((int lvl) -> "ground,friend,vulnerable,invulnerable")
    ..setButtonPositionNormalX(0)
    ..setButtonPositionNormalY(2)