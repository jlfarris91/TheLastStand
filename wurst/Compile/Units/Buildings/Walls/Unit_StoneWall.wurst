package Unit_StoneWall
import TlsUnitDefinition
import ObjectIdGenerator
import Unit_Gate
import Unit_MetalWall
import TlsBuildingDefinition
import initlater Unit_WoodFence
import GameConstants
import TlsUpgradeIds
import HashList

public constant int STONE_WALL_GOLD_COST = 0
public constant int STONE_WALL_LUMBER_COST = 140
public constant int STONE_WALL_REPAIR_GOLD_COST = R2I(STONE_WALL_GOLD_COST * BUILDING_REPAIR_GOLD_SCALAR)
public constant int STONE_WALL_REPAIR_LUMBER_COST = R2I(STONE_WALL_LUMBER_COST * BUILDING_REPAIR_LUMBER_SCALAR)
public constant int STONE_WALL_RECYCLE_GOLD_COST = WOOD_FENCE_GOLD_COST + STONE_WALL_GOLD_COST
public constant int STONE_WALL_RECYCLE_LUMBER_COST = WOOD_FENCE_LUMBER_COST + STONE_WALL_LUMBER_COST

public constant int STONE_WALL_REPAIR_TIME = 10
public constant int STONE_WALL_BUILD_TIME = 10
public constant int STONE_WALL_HEALTH = 1000
public constant real STONE_WALL_SCALE_DIAGONAL = 0.60
public constant real STONE_WALL_SCALE_HORIZONTAL = 0.65

StoneWallDefinition array g_stoneWallDefs
public HashList<int> g_stoneWallIds

// ============================================================================
public class StoneWallIds
  static constant int ew = compiletime(UNIT_ID_GEN.next())
  static constant int nesw = compiletime(UNIT_ID_GEN.next())
  static constant int ns = compiletime(UNIT_ID_GEN.next())
  static constant int nwse = compiletime(UNIT_ID_GEN.next())

// ============================================================================
class StoneWallDefinition extends TlsBuildingDefinition
  construct(int newId, int angle)
    super(newId, UnitIds.scouttower)
    setName("Stone Wall")
    setShadowTextureBuilding("")
    setButtonPositionX(0)
    setButtonPositionY(0)
    setDeathTimeseconds(0.83)
    setGroundTexture("")
    setSelectionScale(4.0)
    setDeathType(DeathType.CannotRaiseDoesNotDecay)
    setArmorType(ArmorType.Fortified)
    setCollisionSize(0.0)
    setPlacementRequires("unbuildable,unwalkable")
    setBuildTime(STONE_WALL_BUILD_TIME)
    setCanFlee(false)
    setHideMinimapDisplay(true)
    setHitPointsMaximumBase(STONE_WALL_HEALTH)

    setGoldCost(STONE_WALL_GOLD_COST)
    setMaterialCost(STONE_WALL_LUMBER_COST)
    setRepairGoldCost(STONE_WALL_REPAIR_GOLD_COST)
    setRepairLumberCost(STONE_WALL_REPAIR_LUMBER_COST)
    setRecycleGoldRewarded(STONE_WALL_RECYCLE_GOLD_COST)
    setRecycleLumberRewarded(STONE_WALL_RECYCLE_LUMBER_COST)

    setRepairTime(STONE_WALL_REPAIR_TIME)
    setSightRadiusDay(STRUCTURE_LARGE_SIGHT_RANGE_DAY)
    setSightRadiusNight(STRUCTURE_LARGE_SIGHT_RANGE_NIGHT)
    setNormalAbilities(commaList(TlsAbilityIds.recycle))
    setRequirements(commaList(TlsUnitIds.campHouse))
    setUpgradesUsed(commaList(TlsUpgradeIds.campDefense))
    
    setIconGameInterface(StoneWallUtility.getIcon(angle))
    setModelFile(StoneWallUtility.getModelPath(angle))
    setPathingMap(StoneWallUtility.getPathMap(angle))
    
    let metalWallId = MetalWallUtility.getId(angle)
    let gateId = GateUtility.getBuildGateId(angle)
    setUpgradesTo(commaList(metalWallId, gateId))

    setTooltipBasic("Build Fence")
    setTooltipExtended("Upgrade to a strong stone wall.")

// ============================================================================
@compiletime
function createWallUnitVariations()
  let row = 2
  g_stoneWallDefs[0] = createWallUnitVariation(315, 0, row, "Diagonal (NE SW)", STONE_WALL_SCALE_DIAGONAL)
  g_stoneWallDefs[1] = createWallUnitVariation(0, 0, row, "Horizontal (NS)", STONE_WALL_SCALE_HORIZONTAL)
  g_stoneWallDefs[2] = createWallUnitVariation(90, 0, row, "Vertical (EW)", STONE_WALL_SCALE_HORIZONTAL)
  g_stoneWallDefs[3] = createWallUnitVariation(45, 0, row, "Diagonal (NW SE)", STONE_WALL_SCALE_DIAGONAL)

// ============================================================================
function createWallUnitVariation(int angle, int buttonPosX, int buttonPosY, string name, real scale) returns StoneWallDefinition
  return new StoneWallDefinition(StoneWallUtility.getId(angle), angle)
    ..setNameEditorSuffix(name + " (Wall Level 2)")
    ..setButtonPositionX(buttonPosX)
    ..setButtonPositionY(buttonPosY)
    ..setTooltipBasic("Upgrade to Stone Wall")
    ..setTooltipExtended("|cffffcc00" + name + "|r|nUpgrade to a strong stone wall.")
    ..setScalingValue(scale)

// ============================================================================
public class StoneWallUtility

  // --------------------------------------------------------------------------
  static function getId(int angle) returns int
    switch (angle)
      case 0
        return StoneWallIds.ns
      case 45
        return StoneWallIds.nwse
      case 90
        return StoneWallIds.ew
      case 315
        return StoneWallIds.nesw
    return -1

  // --------------------------------------------------------------------------
  static function getPathMap(int angle) returns string
    switch (angle)
      case 0
        return "Units\\Wall1\\Wall1_0.tga"
      case 45
        return "Units\\Wall1\\Wall1_45.tga"
      case 90
        return "Units\\Wall1\\Wall1_90.tga"
      case 315
        return "Units\\Wall1\\Wall1_135.tga"
    return ""

  // --------------------------------------------------------------------------
  static function getModelPath(int angle) returns string
    switch (angle)
      case 0
        return "Doodads\\LordaeronSummer\\Terrain\\StoneWall0\\StoneWall02.mdl"
      case 45
        return "Doodads\\LordaeronSummer\\Terrain\\StoneWall135\\StoneWall1352.mdl"
      case 90
        return "Doodads\\LordaeronSummer\\Terrain\\StoneWall90\\StoneWall902.mdl"
      case 315
        return "Doodads\\LordaeronSummer\\Terrain\\StoneWall45\\StoneWall452.mdl"
    return ""

  // --------------------------------------------------------------------------
  static function getIcon(int angle) returns string
    switch (angle)
      case 0
        return "ReplaceableTextures\\CommandButtons\\BTNWall1_0.BLP"
      case 45
        return "ReplaceableTextures\\CommandButtons\\BTNWall1_45.BLP"
      case 90
        return "ReplaceableTextures\\CommandButtons\\BTNWall1_90.BLP"
      case 315
        return "ReplaceableTextures\\CommandButtons\\BTNWall1_135.BLP"
    return ""

// ============================================================================
init
  g_stoneWallIds = new HashList<int>()
  ..add(StoneWallIds.ew)
  ..add(StoneWallIds.nesw)
  ..add(StoneWallIds.ns)
  ..add(StoneWallIds.nwse)

  createWallUnitVariations()