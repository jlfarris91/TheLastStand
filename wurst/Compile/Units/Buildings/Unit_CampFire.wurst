package Unit_CampFire
import TlsBuildingDefinition
import ColorUtility
import Doodads
import BuildingUndeadTarget
import TlsUpgradeIds
import AbilityObjEditing
import BuffObjEditing
import TlsBuffIds
import StringBuilder
import GameConstants

public constant int CAMP_FIRE_2_MANA_MAX = 60
public constant int CAMP_FIRE_2_MANA_COST_PER_SECOND = 1

public constant real CAMPFIRE1_HP_REGEN_FLAT = 20.0
public constant real CAMPFIRE1_MANA_REGEN_FLAT = 10.0
public constant real CAMPFIRE1_AREA_OF_EFFECT = 500

public constant real CAMPFIRE2_HP_SCALE = 1.5
public constant real CAMPFIRE2_MANA_SCALE = 2.0
public constant real CAMPFIRE2_AREA_OF_EFFECT = 750

public TlsBuildingDefinition g_campFireDefinition
public TlsBuildingDefinition g_campFireBuildDefinition
public TlsBuildingDefinition g_campFire2Definition

// ============================================================================
public class CampFireDefinition extends TlsBuildingDefinition
  construct(int newId)
    super(newId, UnitIds.fountainofhealth)
    this.makeBuildingUndeadTarget()
    setName("Camp Fire")
    setTooltipBasic("Build Camp Fire")
    setTooltipExtended("Standing near the Camp Fire restores <{0},DataA1> mana per second.|n|nThe Camp Fire can also be used to cook a variety of recipes with different bonus effects.|n|n{2}".format(
      TlsAbilityIds.campFireRestoreMana.toRawCode(),
      "Does not stack!".colorize(Colors.gold)))
    setHotkey("R")
    setRace(Race.Human)
    setButtonPositionX(0)
    setButtonPositionY(2)
    setDeathTimeseconds(0.1)
    setGroundTexture("")
    setIconGameInterface("ReplaceableTextures\\CommandButtons\\BTNFirePit.blp")
    setModelFile("Doodads\\Northrend\\Props\\FirePit\\FirePit.mdl")
    setScalingValue(0.75)
    setSelectionScale(1.75)
    setShadowTextureBuilding("")
    setTintingColorRed(100)
    setTintingColorBlue(100)
    setTintingColorGreen(100)
    setArmorType(ArmorType.Fortified)
    setDeathType(DeathType.CannotRaiseDoesNotDecay)
    setCollisionSize(16.0)
    setPathingMap("PathTextures\\4x4Default.tga")
    setPlacementRequires("unbuildable,unwalkable")
    setUnitSoundSet("LavaSpawn")
    setBuildTime(BUILD_TIME_BUILDING_SMALL)
    setRepairTime(REPAIR_TIME_BUILDING_SMALL)
    setCanFlee(false)
    setHideMinimapDisplay(true)
    setHitPointsMaximumBase(50)
    setHitPointsRegenerationType("day")
    setUnitClassification("mechanical")
    setUpgradesTo("")
    setUpgradesUsed(commaList(TlsUpgradeIds.campDefense))
    setRequirements("")
    
    setManaMaximum(0)
    setManaInitialAmount(0)
    setManaRegeneration(0)

    setHitPointsMaximumBase(300)
    setDefenseBase(10)
    setDefenseUpgradeBonus(5)

    setGoldCost(0)
    setLumberCost(60)
    this.setCommonBuildingProperties()

// ============================================================================
@compiletime function createCampFire()

  g_campFireBuildDefinition = new CampFireDefinition(TlsUnitIds.campFireBuild)
    ..setButtonPositionX(2)
    ..setButtonPositionY(0)
    ..setSightRadiusDay(400)
    ..setSightRadiusNight(400)
    ..setNormalAbilities(commaList(TlsAbilityIds.buildingInventory, TlsAbilityIds.recycle))
    ..setUpgradesTo(commaList(TlsUnitIds.campFire2))
    ..setManaInitialAmount(0)
    ..setManaMaximum(0)

  g_campFireDefinition = new CampFireDefinition(TlsUnitIds.campFire)
    ..setSightRadiusDay(400)
    ..setSightRadiusNight(400)
    ..setNormalAbilities(commaList(TlsAbilityIds.buildingInventory, TlsAbilityIds.recycle))
    ..setButtonPositionX(0)
    ..setButtonPositionY(-11)
    ..setUpgradesTo(commaList(TlsUnitIds.campFire2))
    ..setGoldCost(0)
    ..setLumberCost(0)
    ..setBuildTime(1)

  g_campFire2Definition = new CampFireDefinition(TlsUnitIds.campFire2)
    ..setName("Cooking Camp Fire")
    ..setModelFile(Doodads.firePitPig)
    ..setSightRadiusDay(600)
    ..setSightRadiusNight(600)
    ..setNormalAbilities(commaList(TlsAbilityIds.buildingInventory, TlsAbilityIds.recycle))
    ..setButtonPositionX(0)
    ..setButtonPositionY(-11)
    ..setUpgradesTo(commaList(TlsUnitIds.campFire))
    ..setGoldCost(0)
    ..setLumberCost(0)
    ..setBuildTime(1)
    ..setManaMaximum(CAMP_FIRE_2_MANA_MAX)

  new AbilityDefinitionAuraRegenerationHealingWard(TlsAbilityIds.campFireRestoreHealth)
    ..setName("Restoring Health")
    ..setEditorSuffix("(Camp Fire)")
    ..setTargetAttachmentPoint("origin")
    ..setAmountofHitPointsRegenerated(1, CAMPFIRE1_HP_REGEN_FLAT)
    ..setPercentage(1, false)
    ..setTargetsAllowed(1, "organic,player,allies")
    ..presetAreaofEffect((int lvl) -> CAMPFIRE1_AREA_OF_EFFECT)

  new BuffDefinition(TlsBuffIds.campFireRestore, 'BHab')
    ..setTooltipNormal("Camp Fire")
    ..setTooltipNormalExtended(1, "Standing near a camp fire restores health and mana.")
    ..setIcon("ReplaceableTextures\\CommandButtons\\PASFirePit.blp")

  let campFire1Tooltip = new StringBuilder()
  campFire1Tooltip.appendLine("Standing near the Camp Fire restores <{0},DataA1> mana per second.".format(TlsAbilityIds.campFireRestoreMana.toRawCode()))
  campFire1Tooltip.appendLine()
  campFire1Tooltip.appendLine("Aura does not stack!".red())
  campFire1Tooltip.appendLine()
  campFire1Tooltip.appendLine("Crafting".gold())
  campFire1Tooltip.appendLine(" · Place items in the Camp Fire's inventory to reveal recipes that can be cooked.")
  campFire1Tooltip.appendLine(" · While cooking, the recipe will change the effect of the Camp Fire's aura.")
  campFire1Tooltip.appendLine(" · When the recipe is finished cooking the cooked item will appear in the Camp Fire's inventory.")

  new AbilityDefinitionAuraBrilliancecreep(TlsAbilityIds.campFireRestoreMana)
    ..setName("Restoring Mana")
    ..setEditorSuffix("(Camp Fire)")
    ..setTargetAttachmentPoint("origin")
    ..presetManaRegenerationIncrease((int lvl) -> CAMPFIRE1_MANA_REGEN_FLAT)
    ..presetPercentBonus((int lvl) -> false)
    ..setTargetsAllowed(1, "organic,player,allies")
    ..presetIcon("ReplaceableTextures\\CommandButtons\\PASFirePit.blp")
    ..presetTooltipNormal((int lvl) -> "Camp Fire")
    ..presetTooltipNormalExtended((int lvl) -> campFire1Tooltip.toStringAndDestroy())
    ..presetBuffs((int lvl) -> commaList(TlsBuffIds.campFireRestore))
    ..presetAreaofEffect((int lvl) -> CAMPFIRE1_AREA_OF_EFFECT)

  new AbilityDefinitionAuraRegenerationHealingWard(TlsAbilityIds.campFire2RestoreHealth)
    ..setName("Restoring Health")
    ..setEditorSuffix("(Camp Fire 2)")
    ..setAmountofHitPointsRegenerated(1, CAMPFIRE1_HP_REGEN_FLAT * CAMPFIRE2_HP_SCALE)
    ..setPercentage(1, false)
    ..setTargetsAllowed(1, "organic,player,allies")
    ..presetAreaofEffect((int lvl) -> CAMPFIRE2_AREA_OF_EFFECT)

  let campFire2Tooltip = new StringBuilder()
  campFire2Tooltip.appendLine("Standing near the Camp Fire restores <{0},DataA1> health and <{1},DataA1> mana per second.".format(TlsAbilityIds.campFire2RestoreHealth.toRawCode(), TlsAbilityIds.campFire2RestoreMana.toRawCode()))
  campFire2Tooltip.appendLine()
  campFire2Tooltip.appendLine("Aura does not stack!".red())
  campFire2Tooltip.appendLine()
  campFire2Tooltip.appendLine("Crafting".gold())
  campFire2Tooltip.appendLine(" · The Cooking Camp Fire drains mana at a rate of {0} mana per second and finishes cooking when its mana reaches zero.".format(CAMP_FIRE_2_MANA_COST_PER_SECOND.toString()))
  campFire2Tooltip.appendLine(" · While cooking, the recipe will change the effect of the Camp Fire's aura.")
  campFire2Tooltip.appendLine(" · When the recipe is finished cooking the cooked item will appear in the Camp Fire's inventory.")

  new AbilityDefinitionAuraBrilliancecreep(TlsAbilityIds.campFire2RestoreMana)
    ..setName("Resoring Mana")
    ..setEditorSuffix("(Camp Fire 2)")
    ..setTargetAttachmentPoint("origin")
    ..presetManaRegenerationIncrease((int lvl) -> CAMPFIRE1_MANA_REGEN_FLAT * CAMPFIRE2_MANA_SCALE)
    ..presetPercentBonus((int lvl) -> false)
    ..setTargetsAllowed(1, "organic,player,allies")
    ..presetIcon("ReplaceableTextures\\CommandButtons\\PASFirePit.blp")
    ..presetTooltipNormal((int lvl) -> "Cooking Camp Fire")
    ..presetTooltipNormalExtended((int lvl) -> campFire2Tooltip.toStringAndDestroy())
    ..presetBuffs((int lvl) -> commaList(TlsBuffIds.campFireRestore))
    ..presetAreaofEffect((int lvl) -> CAMPFIRE2_AREA_OF_EFFECT)
    
// ============================================================================
init
  createCampFire()