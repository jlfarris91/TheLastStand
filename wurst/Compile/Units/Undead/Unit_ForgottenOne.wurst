package Unit_ForgottenOne
import TlsUndeadUnitDefinition
import TlsUnitIds
import UnitIds
import UndeadUnitCompileUtils
import AbilityObjEditing
import TlsAbilityIds
import ObjectIds
import GameConstants
import Range

// ============================================================================
function createForgottenOneDefinition(int id) returns TlsUndeadUnitDefinition
  
  return new TlsUndeadUnitDefinition(id, UnitIds.forgottenone)
    ..setArmorType(ArmorType.Fortified)
    ..setAcquisitionRange(SPAWN_RANGE_FAR.max)
    ..setSightRadiusDay(INT_MAX)
    ..setSightRadiusNight(INT_MAX)
    ..setCommonDefinitionForGroundMeleeEnemy()
    ..protectAgainstUnitRecycler()

    // This prevents forgotten ones from spawning on top of eachother
    ..setMovementType(MovementType.Foot)

// ============================================================================
function createTentacleDefinition(int id) returns TlsUndeadUnitDefinition

  return new TlsUndeadUnitDefinition(id, UnitIds.tentacle)
    ..setCollisionSize(8.0)
    ..setAttack1AttackType(AttackType.Normal)
    ..setArmorType(ArmorType.Normal)
    ..setCommonDefinitionForGroundMeleeEnemy()
    ..protectAgainstUnitRecycler()

// ============================================================================
@compiletime function createUnits()
  
  new AbilityDefinitionSerpentWardtentacleForgottenone(TlsAbilityIds.spawnTentacles)
    ..setLevels(3)
    ..presetCooldown((int lvl) -> 10.0)
    ..presetSummonedUnitType((int lvl) -> TlsUnitIds.Undead.tentacles[lvl-1].toRawCode())
    ..presetSummonedUnitCount((int lvl) -> lvl)
    ..presetCastRange((int lvl) -> SPAWN_RANGE_FAR.max * 1.5)
    ..presetDurationNormal((int lvl) -> 30.0 + (lvl - 1) * 10.0) // The duration of the ward timer
    ..presetDurationHero((int lvl) -> 30.0 + (lvl - 1) * 10.0)

  // Forgotten One

  createForgottenOneDefinition(TlsUnitIds.Undead.forgottenOnes[0])
    ..setCommonDefinitionTier1()
    ..setNormalAbilities(commaList(TlsAbilityIds.spawnTentacles, AbilityIds.firebolt))
    ..setScalingValue(0.85)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(255)
    ..setTintingColorBlue(255)
    ..setTooltipBasic("Forgotten One - Tier I")
    ..setTooltipExtended("Fortified ranged boss unit. Repeatedly spawns Tentacles near units until killed.")

  createForgottenOneDefinition(TlsUnitIds.Undead.forgottenOnes[1])
    ..setCommonDefinitionTier2()
    ..setNormalAbilities(commaList(TlsAbilityIds.spawnTentacles, AbilityIds.firebolt))
    ..setScalingValue(1.0)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(150)
    ..setTintingColorBlue(100)
    ..setTooltipBasic("Forgotten One - Tier II")
    ..setTooltipExtended("Fortified ranged boss unit. Repeatedly spawns Tentacles near units until killed.")

  createForgottenOneDefinition(TlsUnitIds.Undead.forgottenOnes[2])
    ..setCommonDefinitionTier3()
    ..setNormalAbilities(commaList(TlsAbilityIds.spawnTentacles, AbilityIds.firebolt))
    ..setScalingValue(1.15)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(100)
    ..setTintingColorBlue(50)
    ..setTooltipBasic("Forgotten One - Tier III")
    ..setTooltipExtended("Fortified ranged boss unit. Repeatedly spawns Tentacles near units until killed.")

  // Tentacles

  createTentacleDefinition(TlsUnitIds.Undead.tentacles[0])
    ..setCommonDefinitionTier1()
    ..setScalingValue(0.85)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(255)
    ..setTintingColorBlue(255)
    ..setAttack1Range(MELEE_UNIT_ATTACK_RANGE * 2)
    ..setTooltipBasic("Tentacle - Tier I")
    ..setTooltipExtended("Melee unit spawned from a Forgotten One.")
    ..setUnitClassification("summoned")

  createTentacleDefinition(TlsUnitIds.Undead.tentacles[1])
    ..setCommonDefinitionTier2()
    ..setScalingValue(1.0)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(100)
    ..setTintingColorBlue(50)
    ..setAttack1Range((MELEE_UNIT_ATTACK_RANGE * 2.5).floor())
    ..setTooltipBasic("Tentacle - Tier II")
    ..setTooltipExtended("Melee unit spawned from a Forgotten One.")
    ..setUnitClassification("summoned")

  createTentacleDefinition(TlsUnitIds.Undead.tentacles[2])
    ..setCommonDefinitionTier3()
    ..setScalingValue(1.15)
    ..setTintingColorRed(255)
    ..setTintingColorGreen(100)
    ..setTintingColorBlue(50)
    ..setAttack1Range(MELEE_UNIT_ATTACK_RANGE * 3)
    ..setTooltipBasic("Tentacle - Tier III")
    ..setTooltipExtended("Melee unit spawned from a Forgotten One.")
    ..setUnitClassification("summoned")