package Ability_Sprint
import RegisterEvents
import Orders
import UnitMetadata
import SprintComponent

constant int SPRINT_ORDER_ID = OrderIds.berserk

// ============================================================================
function onSprintOrdered()
  let u = GetOrderedUnit()
  let order = GetIssuedOrderId()

  if (order != SPRINT_ORDER_ID)
    return

  let metadata = u.getMetadata()
  if (metadata == null)
    return

  let sprintComponent = metadata.getComponent(typeInfo(SprintComponent.typeId)) castTo SprintComponent
  if (sprintComponent == null)
    return

  if (sprintComponent.getIsSprinting())
    sprintComponent.stopSprinting()
  else
    sprintComponent.startSprinting()

// ============================================================================
init
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_ISSUED_ORDER, function onSprintOrdered)