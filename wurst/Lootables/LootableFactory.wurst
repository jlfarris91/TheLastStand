package LootableFactory
import LootableTypes
import UnitMetadata
import initlater Lootables
import MainItemLibrary
import LootableGoldReward
import Range

constant ItemChances g_defaultItemChances = ItemChances(83.0, 12.0, 4.0, 1.0)

// ============================================================================
public class LootableFactory implements IUnitMetadataFactory

  // --------------------------------------------------------------------------
  override function createUnit(unit u) returns IUnitMetadata
    let id = u.getTypeId()

    if (id == UNIT_ID_LOOTABLE_BARREL or
        id == UNIT_ID_LOOTABLE_CART or
        id == UNIT_ID_LOOTABLE_CRATES or
        id == UNIT_ID_LOOTABLE_JUNK_1 or
        id == UNIT_ID_LOOTABLE_JUNK_2)
      return createLootableUnit()

    if (id == UNIT_ID_LOOTABLE_HOUSE_SMALL_GREEN or
        id == UNIT_ID_LOOTABLE_HOUSE_LARGE_RED or
        id == UNIT_ID_LOOTABLE_HOUSE_LARGE_BLUE)
      return createLootableHouse()

    if (id == UNIT_ID_LOOTABLE_BUILDING_VERTICAL_RED or
        id == UNIT_ID_LOOTABLE_BUILDING_VERTICAL_GREEN or
        id == UNIT_ID_LOOTABLE_BUILDING_VERTICAL_BLUE or
        id == UNIT_ID_LOOTABLE_BUILDING_HORIZONTAL_RED or
        id == UNIT_ID_LOOTABLE_BUILDING_HORIZONTAL_GREEN or
        id == UNIT_ID_LOOTABLE_BUILDING_HORIZONTAL_BLUE or
        id == UNIT_ID_LOOTABLE_BUILDING_DIAGONAL_RED or
        id == UNIT_ID_LOOTABLE_BUILDING_DIAGONAL_GREEN or
        id == UNIT_ID_LOOTABLE_BUILDING_DIAGONAL_BLUE or
        id == UNIT_ID_LOOTABLE_TENT or
        id == UNIT_ID_LOOTABLE_BARN)
      return createLootableBuilding()

    if (id == UNIT_ID_LOOTABLE_BUILDING_LARGE_HORIZONTAL_GREEN or
        id == UNIT_ID_LOOTABLE_BUILDING_LARGE_VERTICAL_PURPLE or
        id == UNIT_ID_LOOTABLE_INN or
        id == UNIT_ID_LOOTABLE_TAVERN)
      return createLootableBuildingLarge()

    return null    

  // --------------------------------------------------------------------------
  private function createLootableUnit() returns LootableUnit
    let lootable = new LootableUnit()
    ..setSearchDuration(5.0)

    let goldReward = new LootableGoldReward(rangeInt(1,1))

    let materialsReward = new LootableMaterialsReward()
    ..setMinMaterials(30)
    ..setMaxMaterials(60)

    let itemReward = new LootableItemReward()
    ..setItemChances(g_defaultItemChances)
    
    lootable.getRewardsSet()
    ..add(goldReward, 10.0)
    ..add(materialsReward, 50.0)
    ..add(itemReward, 20.0)

    return lootable

  // --------------------------------------------------------------------------
  private function createLootableHouse() returns LootableUnit
    let lootable = new EnterableLootable()
    ..setSearchDuration(10.0)

    let goldReward = new LootableGoldReward(rangeInt(1,3))

    let materialsReward = new LootableMaterialsReward()
    ..setMinMaterials(40)
    ..setMaxMaterials(80)

    let itemReward = new LootableItemReward()
    ..setItemChances(g_defaultItemChances)

    let survivorReward = new LootableSurvivorReward()

    let zombieReward = new LootableZombieReward()
    ..setMinZombies(1)
    ..setMaxZombies(3)
    
    lootable.getRewardsSet()
    ..add(goldReward, 10.0)
    ..add(materialsReward, 50.0)
    ..add(itemReward, 25.0)
    ..add(survivorReward, 5.0)
    ..add(zombieReward, 10.0)

    return lootable

  // --------------------------------------------------------------------------
  private function createLootableBuilding() returns LootableUnit

    let lootable = new EnterableLootable()
    ..setSearchDuration(20.0)

    let goldReward = new LootableGoldReward(rangeInt(2,4))

    let materialsReward = new LootableMaterialsReward()
    ..setMinMaterials(60)
    ..setMaxMaterials(120)

    let itemReward = new LootableItemReward()
    ..setItemChances(g_defaultItemChances)

    let survivorReward = new LootableSurvivorReward()

    let zombieReward = new LootableZombieReward()
    ..setMinZombies(2)
    ..setMaxZombies(4)
    
    lootable.getRewardsSet()
    ..add(goldReward, 10.0)
    ..add(materialsReward, 50.0)
    ..add(itemReward, 25.0)
    ..add(survivorReward, 5.0)
    ..add(zombieReward, 10.0)

    return lootable

  // --------------------------------------------------------------------------
  private function createLootableBuildingLarge() returns LootableUnit
    let lootable = new EnterableLootable()
    ..setSearchDuration(30.0)

    let goldReward = new LootableGoldReward(rangeInt(3,5))

    let materialsReward = new LootableMaterialsReward()
    ..setMinMaterials(80)
    ..setMaxMaterials(160)

    let itemReward = new LootableItemReward()
    ..setItemChances(g_defaultItemChances)

    let survivorReward = new LootableSurvivorReward()

    let zombieReward = new LootableZombieReward()
    ..setMinZombies(5)
    ..setMaxZombies(10)
    
    lootable.getRewardsSet()
    ..add(goldReward, 10)
    ..add(materialsReward, 50.0)
    ..add(itemReward, 25.0)
    ..add(survivorReward, 5.0)
    ..add(zombieReward, 10.0)

    return lootable