package LootGoldCard
import Lootables
import FX
import Notifications
import TlsSounds
import Icons
import ColorUtility
import UnitMetadata

constant real array TIER_VALUE_MULTIPLIER = [1.0, 2.0, 3.0]

// ============================================================================
public class LootGoldCard extends LootCard

  // --------------------------------------------------------------------------
  construct(string id)
    super(id)

  // ----------------------------------------------------------------------------
  override function getTierCount() returns int
    return 3

  // ----------------------------------------------------------------------------
  override function getTierValueMultiplier(int tier) returns real
    return Pow(2.0, tier.toReal())

  // --------------------------------------------------------------------------
  override function activateCard(int tier) returns bool
    
    let lootable = getLootable()
    let looter = getLooter()
    
    let owner = looter.getOwner()
    let lootableComp = lootable.getMetadata().getLootableComponent()

    let gold = tier + 1

    owner.addGold(gold)
    
    FX.createGainedGoldTag(looter.getPos(), gold, owner)
    FX.createGainedGoldEffect(looter.getPos(), owner)

    let notification = new LootRewardNotification(
      NotificationManager.nextNotificationId(),
      owner,
      looter.getPos(),
      TlsSounds.getRandomFoundGold())
    ..setMessage("Found " + ("+" + gold.toString() + " gold").gold())
    ..setIconPath(Icons.bTNChestOfGold)

    lootableComp.showLootRewardNotification(owner, notification)

    return true