package Tips
import HumanPlayers
import WeightedSet
import Icons
import ColorUtility
import ClosureTimers

string array g_tips
int g_tipIndex
constant real SHOW_TIP_INTERVAL = 60.0
WeightedSet<string> g_currentTipSet
force g_tipsForce = CreateForce()
quest g_tipsQuest

// ============================================================================
public class Tips

  // --------------------------------------------------------------------------
  static function showTipsForPlayer(player p, bool showTips)
    if (showTips)
      g_tipsForce.addPlayer(p)
    else
      g_tipsForce.removePlayer(p)

// ============================================================================
function showTipsToPlayers()
  if (g_currentTipSet.isEmpty())
    updateCurrentSet()

  DisplayTextToForce(g_tipsForce, g_currentTipSet.getRandom())
  
// ============================================================================
function updateCurrentSet()
  g_currentTipSet.clear()
  for i = 0 to g_tipIndex - 1
    g_currentTipSet.add(g_tips[i], 1.0)

// ============================================================================
function registerTip(string tip)
  let fullTipString = ("Tip #" + (g_tipIndex + 1).toString() + ": ").colorize(Colors.gold) + tip

  QuestItemSetDescription(QuestCreateItem(g_tipsQuest), fullTipString)

  g_tips[g_tipIndex] = fullTipString

  g_tipIndex++

// ============================================================================
function initializeGeneralTips()
  registerTip("Type '-tips' to toggle the displaying of these tips")
  registerTip("Type '-bases' to see easy, medium and hard bases. Type '-bases easy' to see only easy bases.")
  registerTip("Use |cffffcc00Ctrl+R|r to rotate Wooden Fences and Gates |cffffcc00before building them|r")
  registerTip("All base entrances have been designed to fit 1, 2 or 3 walls/gates exactly")
  registerTip("Gates are weaker than walls but can be opened and closed")
  registerTip("Survivors automatically spawn as long as you have less Survivors than the food cap")
  registerTip("Give the |cFFFFCC00Builder Tools|r item to a Survivor to assign them the |cFFFFCC00Builder|r job")
  registerTip("Give the |cFFFFCC00Sturdy Spears|r item to a Survivor to assign them the |cFFFFCC00Spearman|r job")
  registerTip("Give the |cFFFFCC00Holy Book|r item to a Survivor to assign them the |cFFFFCC00Priest|r job")
  registerTip("Give the |cFFFFCC00Hunting Rifle|r item to a Survivor to assign them the |cFFFFCC00Marksman|r job")
  registerTip("|cffffcc00Builders|r can build more advanced structures and repair 2x as fast as regular Survivors")
  registerTip("|cffffcc00Spearmen|r are medium range soldiers that deal extra damage to elites")
  registerTip("|cffffcc00Militia|r are tanky melee units that are effective at killing Zombies")
  registerTip("|cffffcc00Priests|r can heal friendly units and deal magic damage")
  registerTip("|cffffcc00Marksmen|r attack slowly but have high chance to deal critical damage")
  registerTip("Revive dead heroes in a |cffffcc00Chapel|r")
  registerTip("Search abandoned lootable buildings to find |cFFFFCC00gold|r, |cFFFFCC00lumber|r, |cFFFFCC00items|r and |cFFFFCC00survivors|r")
  registerTip("Lootable buildings can be seen clearly even in fog of war")
  registerTip("Use the 4 Waygates located in each quadrant of the map to travel long distances quickly")
  registerTip("Who knows what you may discover when operating the |cffffcc00Scout Tower|r during the day...")
  registerTip("Enemies can spawn anywhere there is fog of war - even in your camp! Build |cFFFFCC00Lamp Posts|r to ensure that your camp is completely revealed.")
  registerTip("|cFFFFCC00Builders|r can cut down trees with the |cFFFFCC00Fell Trees|r research")
  registerTip("Survivors and Builders can harvest lumber from trees without cutting them down")
  registerTip("|cFFFFCC00Spikes|r slow and damage nearby enemies but do not block movement")
  registerTip("Constructing a |cFFFFCC00Shelter|r will increase the max HP of all Survivors")
  registerTip("Each |cFFFFCC00Shelter|r grants bonus max HP to survivors")
  registerTip("Store extra items in a |cFFFFCC00Chest|r")
  registerTip("A |cFFFFCC00Camp Fire|r will slowly regenerate health mana for nearby Survivors and can cook Raw Meat for bonus regen for a limited time")
  registerTip("Looting large buildings grants better rewards but takes more time")
  registerTip("Type '-split X' to split a stack of items in your inventory (0 is top left, 5 is bottom right)")
  registerTip("Press 'Ctrl+Z' to quickly toggle a selected Survivor's assigned job")
  registerTip("Force a Survivor to |cffffcc00unlearn a job|r by ctrl+clicking the job in the Survivor job UI panel")

// ============================================================================
init

  for p in g_PlayingHumanPlayers
    Tips.showTipsForPlayer(p, true)

  doPeriodically(SHOW_TIP_INTERVAL, (cb) -> showTipsToPlayers())

  g_tipsQuest = CreateQuest()
  QuestSetTitle(g_tipsQuest, "Tips")
  QuestSetRequired(g_tipsQuest, false)
  QuestSetIconPath(g_tipsQuest, Icons.bTNMagicalSentry)
  QuestSetDescription(g_tipsQuest, "Shows a list of useful gameplay tips")

  g_currentTipSet = new WeightedSet<string>()

  initializeGeneralTips()