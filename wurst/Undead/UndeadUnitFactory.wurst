package UndeadUnitFactory
import UnitMetadata
import TlsUnitIds
import CryptFiendComponent
import UndeadTargetingComponent
import GameConstants
import GhostComponent
import AbominationComponent
import SummonerComponent
import TlsAbilityIds
import TombstoneComponent
import ForgottenOneComponent

// ============================================================================
public class UndeadUnitComponentGenerator implements IUnitComponentGenerator

  // --------------------------------------------------------------------------
  override function generateComponents(IUnitMetadata metadata) returns bool
    let _unit = metadata.getUnit()
    let unitTypeId = _unit.getTypeId()
    var handled = false

    if (_unit.getOwner() == PLAYER_UNDEAD)
    //{
      metadata.getOrAddUndeadTargetingComponent()
      
      if (not _unit.hasAbility(TlsAbilityIds.enemiesNearby))
        _unit.addAbility(TlsAbilityIds.enemiesNearby)

      handled = true
    //}

    if (unitTypeId.isTypeOfAbomination())
      metadata.getOrAddAbominationComponent()
      handled = true

    if (unitTypeId.isTypeOfNecromancer())
      metadata.getOrAddSummonerComponent()
        ..setAbilityId(TlsAbilityIds.necromancerRaiseDead)
        ..setSummonerUnitTypes(TlsUnitIds.Undead.necromancers[0], TlsUnitIds.Undead.necromancers[1], TlsUnitIds.Undead.necromancers[2])
      handled = true

    if (unitTypeId.isTypeOfFiend())
      metadata.getOrAddCryptFiendComponent()
      handled = true

    if (unitTypeId == TlsUnitIds.Undead.archimonde)
      metadata.getOrAddSummonerComponent()
        ..setAbilityId(TlsAbilityIds.rainOfChaos)
        ..setSummonerUnitTypes(TlsUnitIds.Undead.archimonde, 0, 0)
      handled = true

    if (unitTypeId.isTypeOfGhost())
      metadata.getOrAddGhostComponent()
      handled = true

    if (unitTypeId.isTypeOfTombstone())
      metadata.getOrAddSummonerComponent()
        ..setAbilityId(TlsAbilityIds.tombstoneSummon)
        ..setSummonerUnitTypes(TlsUnitIds.Undead.tombstones[0], TlsUnitIds.Undead.tombstones[1], TlsUnitIds.Undead.tombstones[2])
      metadata.getOrAddTombstoneComponent()
      handled = true

    if (unitTypeId.isTypeOfForgottenOne())
      metadata.getOrAddSummonerComponent()
        ..setAbilityId(TlsAbilityIds.spawnTentacles)
        ..setSummonerUnitTypes(TlsUnitIds.Undead.forgottenOnes[0], TlsUnitIds.Undead.forgottenOnes[1], TlsUnitIds.Undead.forgottenOnes[2])
      metadata.getOrAddForgottenOneComponent()
      handled = true

    return handled