package RealtimeComponent
import Events
import Composition
import ClosureTimers

AnonymousEvent g_updateEvent

public abstract class RealtimeComponent extends Component

  private AnonymousEventHandler _updateHandler
  private bool _isRegisteredForUpdate

  construct(IComposite owner)
    super(owner)
    _isRegisteredForUpdate = false

  ondestroy
    unregisterForUpdate()

  protected function registerForUpdate()
    if (not _isRegisteredForUpdate)
      _isRegisteredForUpdate = true
      _updateHandler = g_updateEvent.addListener() () -> 
        update()

  protected function unregisterForUpdate()
    _updateHandler = g_updateEvent.removeListener(_updateHandler)
    _isRegisteredForUpdate = false

  protected function update()

init
  g_updateEvent = new AnonymousEvent()

  var t = CreateTimer()
  t.doPeriodically(ANIMATION_PERIOD) (CallbackPeriodic cb) ->
    g_updateEvent.invoke()