package HeroComponent
import UnitComponent
import BackpackComponent
import XpReceiverComponent
import RangedTargetXpReceieverComponent
import LooterComponent
import HumanPlayerComponent

// ============================================================================
public class HeroComponent extends UnitComponent

  // --------------------------------------------------------------------------
  construct (IUnitMetadata owner)
    super(owner)
    setDisableOnDeath(false)

  // --------------------------------------------------------------------------
  override function onEnabled()
    super.onEnabled()

    let ownerMetadata = getOwnerUnit().getOwner().getHumanPlayerComponent()
    ownerMetadata.setHero(getOwner())

    getOwner().getOrAddBackpackComponent()
    getOwner().getOrAddXpReceiverComponent()
    getOwner().getOrAddRangedTargetXpRecieverComponent()..setXpPerHit(1)
    getOwner().getOrAddLooterComponent()

  // --------------------------------------------------------------------------
  override function onDisabled()
    super.onDisabled()

    let _unit = getOwnerUnit()
    if (_unit != null)
      let ownerMetadata = _unit.getOwner().getHumanPlayerComponent()
      if (ownerMetadata != null)
        ownerMetadata.setHero(null)

// ============================================================================
public function IUnitMetadata.getHeroComponent() returns HeroComponent
  return this.getComponent(HeroComponent.typeId) castTo HeroComponent

// ============================================================================
public function IUnitMetadata.getOrAddHeroComponent() returns HeroComponent
  var component = this.getHeroComponent()
  if (component == null)
    component = this.addComponent(new HeroComponent(this)) castTo HeroComponent
  return component

// ============================================================================
public function unit.getHeroComponent() returns HeroComponent
  let metadata = this.getMetadata()
  return metadata != null ? metadata.getHeroComponent() : null

// ============================================================================
public function unit.getOrAddHeroComponent() returns HeroComponent
  let metadata = this.getMetadata()
  return metadata != null ? metadata.getOrAddHeroComponent() : null
