package Ability_ImmediateRepair
import ClosureEvents
import TlsAbilityIds
import DisplayTextToPlayer
import FX

// ============================================================================
function onAbilityCast(unit caster, unit target)
  if (target.getHP() == target.getMaxHP())
    let owner = caster.getOwner()
    displayMessageToPlayer(owner, "Target is already at full health")
    let abil = caster.getAbility(TlsAbilityIds.defenseInstantRepair)
    let lvl = caster.getAbilityLevel(TlsAbilityIds.defenseInstantRepair)
    let mana = abil.getField(ABILITY_ILF_MANA_COST, lvl)
    caster.addMana(mana.toReal())
    FX.createGainedManaTag(caster.getPos(), mana, owner)
    return
  
  target.setHP(target.getMaxHP())
  UnitSetConstructionProgress(target, 99)

// ============================================================================
init
  EventListener.onTargetCast(TlsAbilityIds.defenseInstantRepair) (unit caster, unit target) ->
    onAbilityCast(caster, target)