package Recycle
import RegisterEvents
import GameSettings
import FX
import TlsUnitDefinition

constant int ABILITY_ID_RECYCLE = 'A03Y'

// ============================================================================
function onRecycleCast()
  let u = GetSpellAbilityUnit()

  let lumberCost = u.getRecycleLumberRewarded()
  if (lumberCost > 0)
    let reward = R2I(I2R(lumberCost) * GameSettings.structures_RecycleRewardPercentage)
    let owner = u.getOwner()
    let pos = u.getPos()
    FX.createFoundMaterialsEffect(pos, owner)
    FX.createFoundMaterialsTag(pos, reward, owner)
  
  u.setAnimation("death")
  u.kill()

// ============================================================================
init
  registerSpellEffectEvent(ABILITY_ID_RECYCLE, function onRecycleCast)
