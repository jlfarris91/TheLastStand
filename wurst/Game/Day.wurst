package Day
import GameConstants
import GameInstance
import SurvivorSpawnPoints
import Zombies
import HumanPlayers
import PlayerMetadata
import GameSettings
import Heroes
import Survivors
import Items
import Lootables

trigger g_OnDayTrigger

function respawnDeadPlayers()
  g_PlayingHumanPlayers.forEach() (player p) ->
    if (p.getIsDead())
      spawnHeroForPlayerAtRandomPoint(p)

function onDayStart()
  GameInstance.days++

  PlaySoundBJ(gg_snd_QuestCompleted)

  Zombies.stopSpawning()
  Zombies.killAllUndead()
  Zombies.spawnDayZombiesNearPlayers()

  Items.spawnItemsNearPlayers()

  // Must be called after spawning undead and before spawning survivors
  g_SurvivorSpawnPointManager.updateSpawnPointsNow()

  if (GameSettings.allowRespawn)
    respawnDeadPlayers()

  spawnUnrescuedSurvivorsNearPlayers()
  
  decrementLootableCooldowns()

  // TODO: update player stats multiboard

  if (GameInstance.days > 1)
    GameInstance.nights++

  // Have to wait for some reason
  TriggerSleepAction(1.0)
  SetTimeOfDayScalePercentBJ(GAME_SPEED_DAY)

init
  g_OnDayTrigger = CreateTrigger()
  g_OnDayTrigger.registerGameStateEvent(GAME_STATE_TIME_OF_DAY, EQUAL, TIME_OF_DAY)
  g_OnDayTrigger.addAction(function onDayStart)