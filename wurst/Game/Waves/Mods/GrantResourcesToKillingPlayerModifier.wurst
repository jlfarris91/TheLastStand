package GrantResourcesToKillingPlayerModifier
import FunctionalField
import UnitMetadata
import GrantResourceToKillingPlayerComponent
import Func
import Range

// ============================================================================
public class GrantResourcesToKillingPlayerModifier implements IFunctionalUnitModifier
  private Func1<real, real> m_matsChanceFunc
  private RangeIntFunc1<real> m_matsAmountRangeFunc
  private Func1<real, real> m_goldChanceFunc
  private RangeIntFunc1<real> m_goldAmountRangeFunc

  // --------------------------------------------------------------------------
  function getMaterialsChanceFunc() returns Func1<real, real>
    return m_matsChanceFunc

  // --------------------------------------------------------------------------
  function setMaterialsChanceFunc(Func1<real, real> func)
    m_matsChanceFunc = func

  // --------------------------------------------------------------------------
  function getMaterialsAmountRangeFunc() returns RangeIntFunc1<real>
    return m_matsAmountRangeFunc

  // --------------------------------------------------------------------------
  function setMaterialsAmountRangeFunc(RangeIntFunc1<real> func)
    m_matsAmountRangeFunc = func

  // --------------------------------------------------------------------------
  function getGoldChanceFunc() returns Func1<real, real>
    return m_goldChanceFunc

  // --------------------------------------------------------------------------
  function setGoldChanceFunc(Func1<real, real> func)
    m_goldChanceFunc = func

  // --------------------------------------------------------------------------
  function getGoldAmountRangeFunc() returns RangeIntFunc1<real>
    return m_goldAmountRangeFunc

  // --------------------------------------------------------------------------
  function setGoldAmountRangeFunc(RangeIntFunc1<real> func)
    m_goldAmountRangeFunc = func

  // --------------------------------------------------------------------------
  override function apply(unit u, real t)
    let unitMetadata = u.getMetadata()
    if (unitMetadata == null)
      return

    let comp = unitMetadata.getOrAddGrantResourceToKillingPlayerComponent()

    if (m_matsAmountRangeFunc != null and m_matsChanceFunc != null)
      comp.setMaterialsChance(m_matsChanceFunc.call(t))
      comp.setMaterialsAmountRange(m_matsAmountRangeFunc.call(t))
    
    if (m_goldAmountRangeFunc != null and m_goldChanceFunc != null)
      comp.setGoldChance(m_goldChanceFunc.call(t))
      comp.setGoldAmountRange(m_goldAmountRangeFunc.call(t))   
    