package GrantXpOnDeathModifier
import UnitModifier
import Functional
import GrantXpOnDeathComponent
import UnitMetadata

// ============================================================================
public class GrantXpOnDeathModifier extends AggregateUnitModifier
  private FunctionalT<int> m_xpValue

  // --------------------------------------------------------------------------
  construct()
    skip

  // --------------------------------------------------------------------------
  construct(int speed)
    m_xpValue = FunctionalT.fromValue(speed)

  // --------------------------------------------------------------------------
  construct(FunctionalT<int> speed)
    m_xpValue = speed

  // --------------------------------------------------------------------------
  ondestroy
    if (m_xpValue != null)
      destroy m_xpValue
      m_xpValue = null

  // --------------------------------------------------------------------------
  function getXpValue() returns FunctionalT<int>
    return m_xpValue

  // --------------------------------------------------------------------------
  function setXpValue(FunctionalT<int> func)
    m_xpValue = func

  // --------------------------------------------------------------------------
  override function apply(unit u, real t)

    u.getMetadata().getOrAddGrantXpOnDeathComponent()
      ..setExpValue(m_xpValue.getValue(t))