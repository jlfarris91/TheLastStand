package SpawnWaveContext
import ISpawnWave
import GameConstants
import GameInstance

// ============================================================================
public class SpawnWaveContext implements ISpawnWaveContext
  ISpawnWaveDefinition definition
  int waveNumber
  real waveProgress
  real playerDifficulty
  real array[MAX_ELITE_TIER] tierChances

  // --------------------------------------------------------------------------
  construct()
    definition = null
    waveNumber = 0
    waveProgress = 0.0
    playerDifficulty = 1.0
    for i = 0 to MAX_ELITE_TIER-1
      tierChances[i] = 0.0
  
  // --------------------------------------------------------------------------
  override function getSpawnWaveDefinition() returns ISpawnWaveDefinition
    return definition

  // --------------------------------------------------------------------------
  override function getWaveNumber() returns int
    return waveNumber

  // --------------------------------------------------------------------------
  override function getWaveProgress01() returns real
    return waveProgress

  // --------------------------------------------------------------------------
  override function getGameProgress01() returns real
    return (getWaveNumber().toReal() + getWaveProgress01()) / TOTAL_NIGHTS

  // --------------------------------------------------------------------------
  override function getPlayerDifficulty01() returns real
    return playerDifficulty

  // --------------------------------------------------------------------------
  override function getGameDifficulty01() returns real
    return g_GameInstance.getGameDifficulty01()

  // --------------------------------------------------------------------------
  override function getTierChance01(int tier) returns real
    return tierChances[tier]

  // --------------------------------------------------------------------------
  override function getUnitModifierGameProgress01() returns real
    let gameT = getGameProgress01()
    return gameT*gameT

  // --------------------------------------------------------------------------
  override function getUnitModifierDifficultyScalar01() returns real
    return getPlayerDifficulty01()

  // --------------------------------------------------------------------------
  override function clone() returns ISpawnWaveContext
    let clone = new SpawnWaveContext()
    clone.definition = definition
    clone.waveNumber = waveNumber
    clone.waveProgress = waveProgress
    clone.playerDifficulty = playerDifficulty
    for i = 0 to MAX_ELITE_TIER-1
      clone.tierChances[i] = tierChances[i]
    return clone