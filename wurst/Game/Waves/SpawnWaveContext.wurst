package SpawnWaveContext
import ISpawnWave
import GameConstants
import GameInstance

// ============================================================================
public class SpawnWaveContext implements ISpawnWaveContext
  ISpawnWaveDefinition definition
  int waveNumber
  real waveProgress
  real playerDifficulty
  real array[MAX_ELITE_TIER] tierChances
  int tier
  int groupId

  // --------------------------------------------------------------------------
  construct()
    definition = null
    waveNumber = 0
    waveProgress = 0.0
    playerDifficulty = 1.0
    tier = 0
    groupId = 0
    for i = 0 to MAX_ELITE_TIER-1
      tierChances[i] = 0.0
  
  // --------------------------------------------------------------------------
  override function getSpawnWaveDefinition() returns ISpawnWaveDefinition
    return definition

  // --------------------------------------------------------------------------
  override function getWaveNumber() returns int
    return waveNumber

  // --------------------------------------------------------------------------
  override function getWaveProgress01() returns real
    return waveProgress

  // --------------------------------------------------------------------------
  override function getGameProgress01() returns real
    return ((getWaveNumber() - 1).toReal() + getWaveProgress01()) / TOTAL_NIGHTS

  // --------------------------------------------------------------------------
  override function getPlayerDifficulty01() returns real
    return playerDifficulty

  // --------------------------------------------------------------------------
  override function getGameDifficulty01() returns real
    return g_GameInstance.getGameDifficulty01()

  // --------------------------------------------------------------------------
  override function getTierChance01(int tier) returns real
    return tierChances[tier]

  // --------------------------------------------------------------------------
  override function getTier() returns int
    return tier

  // --------------------------------------------------------------------------
  override function getGroupId() returns int
    return groupId

  // --------------------------------------------------------------------------
  override function getUnitModifierGameProgress01() returns real
    return getGameProgress01()

  // --------------------------------------------------------------------------
  override function getUnitModifierDifficultyScalar01() returns real
    return getPlayerDifficulty01()

  // --------------------------------------------------------------------------
  override function clone() returns ISpawnWaveContext
    let clone = new SpawnWaveContext()
    clone.definition = definition
    clone.waveNumber = waveNumber
    clone.waveProgress = waveProgress
    clone.playerDifficulty = playerDifficulty
    clone.tier = tier
    for i = 0 to MAX_ELITE_TIER-1
      clone.tierChances[i] = tierChances[i]
    return clone

  // --------------------------------------------------------------------------
  function getRandomTier() returns int
    var roll01 = GetRandomReal(0, 1)
    var tier = 0
    for i = 0 to MAX_ELITE_TIER - 1
      let tierChance = getTierChance01(i)
      if (roll01 < tierChance)
        tier = i
        break
      roll01 -= tierChance
    return tier
