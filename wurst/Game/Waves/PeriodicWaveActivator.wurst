package PeriodicWaveActivator
import WaveActivator
import ClosureTimers

// ============================================================================
public class PeriodicWaveActivator extends WaveActivatorBase
  private real m_interval
  private CallbackPeriodic m_timerCallback

  // --------------------------------------------------------------------------
  ondestroy
    stopSpawning()

  // --------------------------------------------------------------------------
  function getInterval() returns real
    return m_interval

  // --------------------------------------------------------------------------
  function setInterval(real interval)
    m_interval = interval
    if (getHasStarted())
      restart()

  // --------------------------------------------------------------------------
  override function getHasStarted() returns bool
    return super.getHasStarted()

  // --------------------------------------------------------------------------
  override function getIsRunning() returns bool
    return super.getIsRunning()

  // --------------------------------------------------------------------------
  override function start()
    super.start()

  // --------------------------------------------------------------------------
  override function stop()
    super.stop()

  // --------------------------------------------------------------------------
  override function pause()
    super.pause()

  // --------------------------------------------------------------------------
  override function resume()
    super.resume()

  // --------------------------------------------------------------------------
  override function onStarted()
    super.onStarted()
    startSpawning()

  // --------------------------------------------------------------------------
  override function onStopped()
    super.onStopped()
    stopSpawning()

  // --------------------------------------------------------------------------
  private function restart()
    stopSpawning()
    startSpawning()

  // --------------------------------------------------------------------------
  private function startSpawning()
    m_timerCallback = doPeriodically(getInterval()) (CallbackPeriodic cb) ->
      raiseActivatedEvent()

  // --------------------------------------------------------------------------
  private function stopSpawning()
    if (m_timerCallback != null)
      destroy m_timerCallback