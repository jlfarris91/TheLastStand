package SurvivorUnit
import Camp
import SurvivorJobComponent
import SkillsComponent
import SurvivorMarksmanSkill
import Skills
import ObjectIds
import ErrorHandling
import TlsUnitIds
import SurvivorMedicSkill
import SurvivorSpearmanSkill
import SurvivorMilitiaSkill

// ============================================================================
public class Survivor extends CampUnit
  private SkillsComponent m_skillsComponent
  private SurvivorMarksmanSkill m_marksmanSkill
  private SurvivorSpearmanSkill m_spearmanSkill
  private SurvivorMilitiaSkill m_militiaSkill
  private SurvivorMedicSkill m_medicSkill

  // --------------------------------------------------------------------------
  construct(ICamp camp)
    super(camp)

    addComponent(new SurvivorJobComponent(this))

    m_skillsComponent = new SkillsComponent(this)

    m_marksmanSkill = m_skillsComponent.getOrAddSurvivorMarksmanSkill()..setIsEnabled(false)
    m_spearmanSkill = m_skillsComponent.getOrAddSurvivorSpearmanSkill()..setIsEnabled(false)
    m_militiaSkill = m_skillsComponent.getOrAddSurvivorMilitiaSkill()..setIsEnabled(false)
    m_medicSkill = m_skillsComponent.getOrAddSurvivorMedicSkill()..setIsEnabled(false)

    addComponent(m_skillsComponent)

  // --------------------------------------------------------------------------
  protected override function onUnitChanged(unit oldUnit, unit newUnit)
    super.onUnitChanged(oldUnit, newUnit)

    disableAllSkills()

    if (newUnit == null)
      return

    let newUnitId = newUnit.getTypeId()

    switch (newUnitId)
      case TlsUnitIds.survivorMale
        onLostJob()
      case TlsUnitIds.survivorMarksman | TlsUnitIds.survivorMarksmanTower
        onChangeToMarksman()
      case TlsUnitIds.survivorMedic
        onChangeToMedic()
      case TlsUnitIds.survivorBuilder
        onChangeToBuilder()
      case TlsUnitIds.survivorSpearman
        onChangeToSpearman()
      case TlsUnitIds.survivorMilitia
        onChangeToMilitia()
      default
        error("Invalid unit type: " + newUnitId.toRawCode())
        return

  // --------------------------------------------------------------------------
  private function disableAllSkills()
    m_marksmanSkill.setIsEnabled(false)
    m_medicSkill.setIsEnabled(false)
    m_spearmanSkill.setIsEnabled(false)
    m_militiaSkill.setIsEnabled(false)

  // --------------------------------------------------------------------------
  private function onLostJob()
    // Log.info("Survivor lost job")

  // --------------------------------------------------------------------------
  private function onChangeToMarksman()
    // Log.info("Changed to Marksman job")
    m_marksmanSkill.setIsEnabled(true)

  // --------------------------------------------------------------------------
  private function onChangeToMedic()
    // Log.info("Changed to Medic job")
    m_medicSkill.setIsEnabled(true)
    skip

  // --------------------------------------------------------------------------
  private function onChangeToBuilder()
    // Log.info("Changed to Builder job")
    skip

  // --------------------------------------------------------------------------
  private function onChangeToSpearman()
    // Log.info("Changed to Spearman job")
    m_spearmanSkill.setIsEnabled(true)
    skip

  // --------------------------------------------------------------------------
  private function onChangeToMilitia()
    // Log.info("Changed to Militia job")
    m_militiaSkill.setIsEnabled(true)
    skip