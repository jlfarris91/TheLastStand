package UndeadSpawnManager
import public SpawnManager
import GameConstants

constant real TEST_RADIUS = 800.0

public UndeadSpawnManager g_undeadSpawnManager

public class UndeadSpawnManager extends SpawnManager
  private static group s_testGroup = CreateGroup()

  // --------------------------------------------------------------------------
  override protected function isSpawnPointValid(vec2 pos) returns bool
    if (not super.isSpawnPointValid(pos))
      return false
    s_testGroup.enumUnitsInRange(pos, TEST_RADIUS)
    var isValid = true
    for u from s_testGroup
      if (doesUnitInvalidateUndeadSpawnPoint(u))
        isValid = false
        break
    return isValid

  // ============================================================================
  private function doesUnitInvalidateUndeadSpawnPoint(unit u) returns bool
    return u.isAlive()
           and u.isEnemyOf(PLAYER_UNDEAD)
           and not u.isInvulnerable()

init
  g_undeadSpawnManager = new UndeadSpawnManager()