package SurvivorComponent
import UnitComponent
import Statistic
// import ClosureTimers
import RegisterEvents
// import initlater StatsBoard
import SurvivorData

// ============================================================================
public class SurvivorComponent extends UnitComponent
  private SurvivorData m_survivorData
  // private StatsBoard m_statsBoard

  // --------------------------------------------------------------------------
  construct(IUnitMetadata owner)
    super(owner)

  // --------------------------------------------------------------------------
  ondestroy
    m_survivorData = null

  // --------------------------------------------------------------------------
  override function initialize()
    super.initialize()
    // m_statsBoard = new StatsBoard(this, "Stats")
    // m_statsBoard.updateMultiboardRows()
    
  // --------------------------------------------------------------------------
  function show()
    // if (not m_statsBoard.isShowing())
    //   m_statsBoard.updateMultiboardRows()
    //   m_statsBoard.update()
    //   m_statsBoard.show()
    
  // --------------------------------------------------------------------------
  function hide()
    // if (m_statsBoard.isShowing())
    //   m_statsBoard.hide()

  // --------------------------------------------------------------------------
  function getSurvivorData() returns SurvivorData
    return m_survivorData

  // --------------------------------------------------------------------------
  function setSurvivorData(SurvivorData stats)
    m_survivorData = stats

  // --------------------------------------------------------------------------
  function getStatistic(string key) returns IStatistic
    return m_survivorData.getStatistic(key)

  // --------------------------------------------------------------------------
  function addStatistic(string key, IStatistic statistic)
    m_survivorData.addStatistic(key, statistic)

// ============================================================================
public function IUnitMetadata.getSurvivorComponent() returns SurvivorComponent
  return this.getComponent(Type(SurvivorComponent.typeId)) castTo SurvivorComponent

// ============================================================================
public function IUnitMetadata.getOrAddSurvivorComponent() returns SurvivorComponent
  var component = this.getSurvivorComponent()
  if (component == null)
    component = this.addComponent(new SurvivorComponent(this)) castTo SurvivorComponent
  return component

// ============================================================================
function onUnitSelected()
  let u = GetTriggerUnit()
  let metadata = u.getMetadata()
  if (metadata == null)
    return
  let statsComponent = metadata.getSurvivorComponent()
  if (statsComponent == null)
    return
  statsComponent.show()

// ============================================================================
function onUnitDeselected()
  let u = GetTriggerUnit()
  let metadata = u.getMetadata()
  if (metadata == null)
    return
  let statsComponent = metadata.getSurvivorComponent()
  if (statsComponent == null)
    return
  statsComponent.hide()

// ============================================================================
function delayedInit()
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_SELECTED, function onUnitSelected)
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_DESELECTED, function onUnitDeselected)

// ============================================================================
init
  // doAfter(1.0) () ->
  //   delayedInit()