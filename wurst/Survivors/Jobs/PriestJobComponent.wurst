package PriestJobComponent
import SurvivorJobComponent
import UnitMetadata
import TlsAbilityIds
import SurvivorJobs

// ============================================================================
public class PriestJobComponent extends SurvivorJobComponent
  
  // --------------------------------------------------------------------------
  construct(IUnitMetadata owner)
    super(owner)

  // --------------------------------------------------------------------------
  override function getJobDefinition() returns SurvivorJobDefinition
    return SurvivorJobs.priest

  // --------------------------------------------------------------------------
  protected override function onEnabled()
    super.onEnabled()
    updateAbilities()

  // --------------------------------------------------------------------------
  private function updateAbilities()
    let ownerUnit = getOwnerUnit()
    
    if (not ownerUnit.hasAbility(TlsAbilityIds.priestHeal))
      ownerUnit.addAbility(TlsAbilityIds.priestHeal)
    
    ownerUnit.setAbilityLevel(TlsAbilityIds.priestHeal, ownerUnit.getLevel())

// ============================================================================
public function IUnitMetadata.getPriestJobComponent() returns PriestJobComponent
  return this.getComponent(PriestJobComponent.typeId) castTo PriestJobComponent

// ============================================================================
public function IUnitMetadata.getOrAddPriestJobComponent() returns PriestJobComponent
  var component = this.getPriestJobComponent()
  if (component == null)
    component = this.addComponent(new PriestJobComponent(this), false) castTo PriestJobComponent
  return component

// ============================================================================
init
  SurvivorJobComponent.registerSurvivorJobComponentGetter(SurvivorJobType.Priest, PriestJobComponent.typeId)
  SurvivorJobComponent.registerSurvivorJobComponentFactory(SurvivorJobType.Priest, metadata -> metadata.getOrAddPriestJobComponent())