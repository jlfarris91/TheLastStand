package ShapeshiftingKey
import UnitMetadata
import ItemEffectComponent
import ItemAcquiredPropertyAffectComponent
import UnitPropertiesComponent
import SmartValue
import TlsItemDefinition
import Icons

// ============================================================================
class ShapeshiftingKeyComponent extends ItemAcquiredPropertyAffectComponent

  // --------------------------------------------------------------------------
  construct (IUnitMetadata owner)
    super(owner, TlsItemIds.shapeshiftingKey, UnitProperty.LOOT_DURATION_SCALE, AffectorType.BASE)
  
  // --------------------------------------------------------------------------
  override function getUnitPropertyAffectorValue(int stacks) returns real
    return 0.5

// ============================================================================
@compiletime function createItem()

  new TlsItemDefinition(TlsItemIds.shapeshiftingKey, 'engs')
  ..setName("Shapeshifting Key")
  ..setDescription("A mysterious key with dazzling features that trick the mind. Upon further study it appears that this key can twist and form itself to fit any lock.")
  ..setTooltipBasic("Purchase Shapeshifting Key")
  ..setTooltipExtended("Decreases the time it takes to loot a structure by 50%. Does not stack.")
  ..setInterfaceIcon(Icons.bTNMoonKey)
  ..setGoldCost(4)
  ..setLumberCost(1600)
  ..setStockInitial(0)
  ..setStockMaximum(1)
  ..setStockStartDelay(150)
  ..setStockReplenishInterval(300)
  ..addTlsUnitClassifications(TlsUnitClassification.HUMAN)
  ..build()

// ============================================================================
init
  if (not compiletime)
    createItem()

  ItemEffectComponent.registerComponentFactory(TlsItemIds.shapeshiftingKey) (_unit) ->
  //{
    let metadata = _unit.getMetadata()
    ItemEffectComponent comp = null
    if (metadata != null)
      comp = metadata.getComponent(ShapeshiftingKeyComponent.typeId) castTo ShapeshiftingKeyComponent
      if (comp == null)
        comp = metadata.addComponent(new ShapeshiftingKeyComponent(metadata)) castTo ShapeshiftingKeyComponent
    return comp
  //}