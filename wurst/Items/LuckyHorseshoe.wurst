package LuckyHorseshoe
import RegisterEvents
import TlsItemIds
import LooterComponent
import UnitMetadata

// ============================================================================
function onUnitPickupItem()
  let _item = GetManipulatedItem()
  if (_item.getTypeId() != TlsItemIds.luckyHorseshoe)
    return

  let _unit = GetManipulatingUnit()

  let metadata = _unit.getMetadata()
  if (metadata == null)
    return

  let comp = metadata.getLooterComponent()
  if (comp == null)
    return

  comp.setChanceToLootTwice(0.1)

// ============================================================================
function onUnitDropItem()
  let _item = GetManipulatedItem()
  if (_item.getTypeId() != TlsItemIds.luckyHorseshoe)
    return
    
  let _unit = GetManipulatingUnit()

  let metadata = _unit.getMetadata()
  if (metadata == null)
    return

  let comp = metadata.getLooterComponent()
  if (comp == null)
    return

  // Unit is still holding a pendant
  if (_unit.itemCount(TlsItemIds.luckyHorseshoe) > 1)
    return

  comp.setChanceToLootTwice(0.0)

// ============================================================================
init
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_PICKUP_ITEM, function onUnitPickupItem)
  registerPlayerUnitEvent(EVENT_PLAYER_UNIT_DROP_ITEM, function onUnitDropItem)